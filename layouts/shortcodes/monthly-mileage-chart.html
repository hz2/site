{{- $data := site.Data.monthly_mileage -}}
{{ if $data }}
<div class="chart-container">
  <h3>monthly mileage</h3>
  <canvas id="monthlyMileageChart" height="300"></canvas>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  if (typeof Chart === 'undefined') {
    var script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/chart.js';
    script.onload = initMonthlyChart;
    document.head.appendChild(script);
  } else {
    initMonthlyChart();
  }
  
  function initMonthlyChart() {
    const data = {{ $data | jsonify | safeJS }};
    const labels = data.map(d => {
      const [year, month] = d.month.split('-');
      const date = new Date(year, parseInt(month) - 1);
      return date.toLocaleDateString('en-US', { month: 'short', year: '2-digit' });
    });
    const miles = data.map(d => d.miles);
    const runs = data.map(d => d.runs);
    
    const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
    const textColor = isDark ? '#e0e0e0' : '#333';
    const gridColor = isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';
    
    const ctx = document.getElementById('monthlyMileageChart');
    if (!ctx) return;
    
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [{
          label: 'miles',
          data: miles,
          backgroundColor: isDark ? 'rgba(100, 181, 246, 0.7)' : 'rgba(66, 133, 244, 0.7)',
          borderColor: isDark ? '#64b5f6' : '#4285f4',
          borderWidth: 1,
          borderRadius: 4
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              afterLabel: function(context) {
                return runs[context.dataIndex] + ' runs';
              }
            }
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            title: { display: true, text: 'miles', color: textColor },
            ticks: { color: textColor },
            grid: { color: gridColor }
          },
          x: {
            ticks: { color: textColor },
            grid: { display: false }
          }
        }
      }
    });
  }
});
</script>

<style>
.chart-container {
  margin: 2rem 0;
  padding: 1.5rem;
  background: var(--bg-secondary, #f8f9fa);
  border-radius: 8px;
}
.chart-container h3 {
  margin: 0 0 1rem 0;
  font-size: 1rem;
  font-weight: 500;
  color: var(--text-secondary, #666);
}
.chart-container canvas {
  width: 100% !important;
  height: 300px !important;
}
</style>
{{ end }}
